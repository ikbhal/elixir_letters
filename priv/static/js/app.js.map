{"version":3,"sources":["web/static/js/app.js"],"names":[],"mappings":"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","file":"priv/static/js/app.js","sourcesContent":["import {Socket} from \"phoenix\"\n\nclass App {\n\n  static loadFonts() {\n    // Load them fonts before starting...!\n    WebFont.load({\n      custom: {\n        families: ['alphafridgemagnets_regular']\n      },\n      active: function() {\n          // go go go!!\n          App.init()\n      }\n    })\n  }\n\n  static init(){\n    let socket = new Socket(\"/socket\", {\n      logger: (kind, msg, data) => {\n        //console.log(`${kind}: ${msg}`, data)\n      }\n    })\n\n    socket.connect()\n    socket.onClose( e => console.log(\"CLOSE\", e))\n\n    const $status    = $(\"#status\")\n    const $messages  = $(\"#messages\")\n    const $input     = $(\"#message-input\")\n    const $username  = $(\"#username\")\n    const $draggable = $(\".draggable\")\n    const $client_id  = this.guid()\n    const $room       = this.get_room()\n\n    const chan = socket.chan(\"rooms:\" + $room,\n      { client_id: $client_id }\n    )\n\n    chan.join().receive(\"ignore\", () => console.log(\"auth error\"))\n               .receive(\"ok\", () => console.log(\"join ok\"))\n               .after(10000, () => console.log(\"Connection interruption\"))\n    chan.onError(e => console.log(\"something went wrong\", e))\n    chan.onClose(e => console.log(\"channel closed\", e))\n\n    function onDrag(id,x,y) {\n      chan.push(\"set:position\", {\n        user: $client_id,\n        body: { id: id, x: x, y: y }\n      })\n    }\n\n    function onDragStop(id,x,y) {\n      chan.push(\"save:snapshot\", {})\n    }\n\n    let letters_map = this.setupPixi(chan, onDrag, onDragStop)\n    function move_letter(id, position){\n      let element = letters_map[id]\n      if (element) {\n        element.position.x = position.x\n        element.position.y = position.y\n      }\n    }\n\n    chan.on(\"join\", msg=>{\n      console.log(\"join\", msg)\n\n      // $(\"#content\").keydown(function (event){\n      //   //console.log(\"You pressed the key: \", String.fromCharCode(event.keyCode))\n      // })\n\n      // initialise the letter positions\n      for (var letter in msg.positions){\n        move_letter(letter, msg.positions[letter])\n      }\n\n      $(\"#letters-container\").show()\n\n    })\n\n    $(\"#content\").mousemove(function(event) {\n      chan.push(\"mousemove\",\n        {\n          client_id: $client_id,\n          username: $username.val(),\n          x: event.pageX, y: event.pageY\n        }\n      )\n    })\n\n    chan.on(\"mousemove\", msg => {\n      if (msg.client_id != $client_id){\n        console.log(msg)\n        let element = this.find_or_create_cursor(msg.client_id, msg.username)\n        element\n          .css('top', msg.y - 74)\n          .css('left', msg.x - 12)\n          .stop(true,false)\n          .css('opacity', 1)\n          // .delay(4000)\n          // .fadeOut(\"slow\")\n      }\n    })\n\n    chan.on(\"user_count:update\", msg => {\n      $(\"#user_count\").text(msg.user_count)\n    })\n\n    chan.on(\"update:position\", msg => {\n      if (msg.user != $client_id){\n        move_letter(msg.body.id, msg.body)\n      }\n    })\n\n  }\n\n  static sanitize_id(id) {\n    return encodeURI(id).replace( /(:|\\.|\\?|\\!|\\[|\\]|,)/g, \"\\\\$1\" );\n  }\n\n  static get_room() {\n    let room = window.location[\"hash\"].replace(\"#\",\"\")\n    if (!room.length) { room = \"lobby\" }\n    // console.log(\"room: \", room)\n    return room\n  }\n\n  static guid() {\n    function s4() {\n      return Math.floor((1 + Math\n        .random()) * 0x10000)\n        .toString(16)\n        .substring(1)\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n      s4() + '-' + s4() + s4() + s4()\n  }\n\n  static setupPixi(chan, onDrag, onDragStop) {\n\n    const renderer = PIXI.autoDetectRenderer(window.innerWidth, window.innerHeight, {backgroundColor : 0x97c56e}, false, true)\n    renderer.view.id = \"letters-container\"\n    $(\"#content\").append(renderer.view)\n\n    // create the root of the scene graph\n    let stage = new PIXI.Container(0x97c56e, true)\n\n    // add a shiny background...\n    // let background = PIXI.Sprite.fromImage('/images/lec.jpg')\n    // background.scale.set(0.7)\n    // stage.addChild(background)\n\n    let letters = get_letters()\n    let letters_map = {}\n    for (var i in letters)\n    {\n      let id = letters[i]['code'] + '_' +  letters[i]['count']\n      let char = letters[i]['letter']\n      letters_map[id] = createLetter(id, char, 30, 30) //Math.random() * window.innerWidth, Math.random() * window.innerHeight)\n    }\n\n    function createLetter(id, char, x, y)\n    {\n      let letter = new PIXI.Text(char, { font: '122px alphafridgemagnets_regular', fill: '#cc00ff', align: 'center', stroke: '#FFFFFF', strokeThickness: 12 })\n      letter.interactive = true\n      letter.buttonMode = true\n      letter.anchor.set(0.5)\n      letter.id = id\n      //letter.scale.set(3)\n      letter\n          // events for drag start\n          .on('mousedown', onDragStart)\n          .on('touchstart', onDragStart)\n          // events for drag end\n          .on('mouseup', onDragEnd)\n          .on('mouseupoutside', onDragEnd)\n          .on('touchend', onDragEnd)\n          .on('touchendoutside', onDragEnd)\n          // events for drag move\n          .on('mousemove', onDragMove)\n          .on('touchmove', onDragMove)\n      letter.position.x = x\n      letter.position.y = y\n      stage.addChild(letter)\n      return letter\n    }\n\n    function onDragStart(event)\n    {\n        // store a reference to the data\n        // the reason for this is because of multitouch\n        // we want to track the movement of this particular touch\n        this.data = event.data\n        this.alpha = 0.5\n        this.dragging = true\n    }\n\n    function onDragEnd()\n    {\n        this.alpha = 1\n        this.dragging = false\n        // set the interaction data to null\n        this.data = null\n        onDragStop()\n    }\n\n    function onDragMove()\n    {\n        if (this.dragging)\n        {\n            var newPosition = this.data.getLocalPosition(this.parent)\n            this.position.x = newPosition.x\n            this.position.y = newPosition.y\n\n            onDrag(this.id,newPosition.x,newPosition.y)\n        }\n    }\n\n    requestAnimationFrame(animate)\n    function animate() {\n      for (var i in letters_map)\n      {\n        letters_map[i].rotation += Math.random() * (0.1 - 0.001) + 0\n      }\n      renderer.render(stage)\n\n      requestAnimationFrame(animate)\n    }\n\n    return letters_map\n\n  }\n\n  static find_or_create_cursor(id, username) {\n    let element = $(\"#\" + id)\n    if (!element.length)\n      element =\n        $(\"<div id=\\\"\" + id +\"\\\" class=\\\"mouse\\\"><p class=\\\"name\\\"></p></div>\")\n        .appendTo(\"#content\")\n    element.find( \".name\" ).text(username)\n    return element\n  }\n\n}\n\n$( () => App.loadFonts() )\n\nexport default App\n"]}