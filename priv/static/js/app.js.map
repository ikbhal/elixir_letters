{"version":3,"sources":["web/static/js/app.js"],"names":[],"mappings":"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","file":"priv/static/js/app.js","sourcesContent":["import {Socket} from \"phoenix\"\n\n// let socket = new Socket(\"/ws\")\n// socket.connect()\n// let chan = socket.chan(\"topic:subtopic\", {})\n// chan.join().receive(\"ok\", resp => {\n//   console.log(\"Joined succesffuly!\", resp)\n// })\n\nclass App {\n  static init(){\n    let socket = new Socket(\"/socket\", {\n      logger: (kind, msg, data) => {\n        console.log(`${kind}: ${msg}`, data)\n      }\n    })\n\n    socket.connect()\n    socket.onClose( e => console.log(\"CLOSE\", e))\n\n    const $status    = $(\"#status\")\n    const $messages  = $(\"#messages\")\n    const $input     = $(\"#message-input\")\n    const $username  = $(\"#username\")\n    const $draggable = $(\".draggable\")\n    const $client_id  = this.guid()\n    const $room       = this.get_room()\n\n    const chan = socket.chan(\"rooms:\" + $room, { client_id: $client_id })\n\n    chan.join().receive(\"ignore\", () => console.log(\"auth error\"))\n               .receive(\"ok\", () => console.log(\"join ok\"))\n               .after(10000, () => console.log(\"Connection interruption\"))\n    chan.onError(e => console.log(\"something went wrong\", e))\n    chan.onClose(e => console.log(\"channel closed\", e))\n\n    chan.on(\"join\", msg=>{\n\n      for (var letter in msg.positions){\n        //console.log(\"position received for \", letter)\n        this.move_letter(\n          letter,\n          msg.positions[letter])\n      }\n\n      $(\"#letters-container\").show()\n\n      $(\"#content\").keydown(function (event){\n        //console.log(\"You pressed the key: \", String.fromCharCode(event.keyCode))\n      })\n\n      $(\"#content\").mousemove(function(event) {\n        chan.push(\"mousemove\",\n          {\n            client_id: $client_id,\n            x: event.pageX, y: event.pageY\n          }\n        )\n      })\n\n    })\n\n    chan.on(\"mousemove\", msg => {\n      if (msg.client_id != $client_id){\n        //console.log msg\n        let element = this.find_or_create_cursor(msg.client_id)\n        element\n          .css('top', msg.y - 74)\n          .css('left', msg.x - 12)\n          .stop(true,false)\n          .fadeIn(\"fast\")\n          .delay(2000)\n          .fadeOut(\"slow\")\n      }\n    })\n\n    chan.on(\"user_count:update\", msg => {\n      $(\"#user_count\").text(msg.user_count)\n    })\n\n    chan.on(\"update:position\", msg => {\n      if (msg.user != $client_id){\n        this.move_letter(msg.body.id, msg.body)\n      }\n    })\n\n    $draggable.on(\"drag\", (e, ui) => {\n      chan.push(\"set:position\", {\n        user: $client_id, body: {\n          id: e.target.id, left: ui.position.left, top: ui.position.top\n        }\n      })\n      //$(e.target).css('color',  '#'+('00000'+(Math.random()*16777216<<0).toString(16)).substr(-6))\n    })\n\n    $draggable.on(\"dragstart\", (e, ui) => {\n    })\n\n    $draggable.on(\"dragstop\", (e, ui) => {\n      chan.push(\"save:snapshot\", {})\n    })\n\n    $draggable.draggable()\n\n  }\n\n  static sanitize_id(id) {\n    return encodeURI(id).replace( /(:|\\.|\\?|\\!|\\[|\\]|,)/g, \"\\\\$1\" );\n  }\n\n  static get_room() {\n    let room = window.location[\"hash\"].replace(\"#\",\"\")\n    if (!room.length) { room = \"lobby\" }\n    // console.log(\"room: \", room)\n    return room\n  }\n\n  static guid() {\n    function s4() {\n      return Math.floor((1 + Math\n        .random()) * 0x10000)\n        .toString(16)\n        .substring(1)\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n      s4() + '-' + s4() + s4() + s4()\n  }\n\n  static find_or_create_cursor(id) {\n    let element = $(\"#\" + id)\n    if (!element.length)\n      element =\n        $(\"<div id=\\\"\" + id +\"\\\" class=\\\"mouse\\\"></div>\")\n        .appendTo(\"#content\")\n    return element\n  }\n\n  static move_letter(id, pos) {\n    let element = $(\"#\" + this.sanitize_id(id))\n    if (element.length) {\n      element\n        .css('top', pos.top)\n        .css('left', pos.left)\n    }\n  }\n\n}\n\n$( () => App.init() )\n\nexport default App\n"]}