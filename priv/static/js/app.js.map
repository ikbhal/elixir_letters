{"version":3,"sources":["web/static/js/app.js"],"names":[],"mappings":"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","file":"priv/static/js/app.js","sourcesContent":["import {Socket} from \"phoenix\"\n\n// let socket = new Socket(\"/ws\")\n// socket.connect()\n// let chan = socket.chan(\"topic:subtopic\", {})\n// chan.join().receive(\"ok\", resp => {\n//   console.log(\"Joined succesffuly!\", resp)\n// })\n\nclass App {\n  static init(){\n    let socket = new Socket(\"/socket\", {\n      logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\n    })\n    socket.connect()\n    const $status    = $(\"#status\")\n    const $messages  = $(\"#messages\")\n    const $input     = $(\"#message-input\")\n    const $username  = $(\"#username\")\n    const $draggable = $(\"#draggable\")\n\n    socket.onClose( e => console.log(\"CLOSE\", e))\n\n    const chan = socket.chan(\"rooms:lobby\", {})\n    chan.join().receive(\"ignore\", () => console.log(\"auth error\"))\n               .receive(\"ok\", () => console.log(\"join ok\"))\n               .after(10000, () => console.log(\"Connection interruption\"))\n    chan.onError(e => console.log(\"something went wrong\", e))\n    chan.onClose(e => console.log(\"channel closed\", e))\n\n    $input.off(\"keypress\").on(\"keypress\", e => {\n      if (e.keyCode == 13) {\n        chan.push(\"new:msg\", {user: $username.val(), body: $input.val()})\n        $input.val(\"\")\n      }\n    })\n\n    chan.on(\"new:msg\", msg => {\n      $messages.append(this.messageTemplate(msg))\n      scrollTo(0, document.body.scrollHeight)\n    })\n\n    chan.on(\"new:position\", position => {\n      console.log(\"position received: \", position.body)\n      $draggable.css('left', position.body.left)\n      $draggable.css('top', position.body.top)\n    })\n\n    chan.on(\"user:entered\", msg => {\n      const username = this.sanitize(msg.user || \"anonymous\")\n      $messages.append(`<br/><i>[${username} entered]</i>`)\n    })\n\n    $draggable.on( \"dragstop\", (e, ui) => {\n      chan.push(\"new:position\", {user: $username.val(), body: { left: ui.position.left, top: ui.position.top }})\n    })\n\n    $draggable.draggable()\n\n  }\n\n  static sanitize(html){ return $(\"<div/>\").text(html).html() }\n\n  static messageTemplate(msg){\n    let username = this.sanitize(msg.user || \"anonymous\")\n    let body     = this.sanitize(msg.body)\n\n    return(`<p><a href='#'>[${username}]</a>&nbsp; ${body}</p>`)\n  }\n\n/*\n  //Global constiable as Chrome doesnt allow access to event.dataTransfer in dragover\n\n  const offset_data = \"\"\n\n  static function drag_start(event) {\n      const style = window.getComputedStyle(event.target, null)\n      offset_data =\n        (parseInt(style.getPropertyValue(\"left\"),10) - event.clientX) + ',' +\n        (parseInt(style.getPropertyValue(\"top\"),10) - event.clientY)\n      event.dataTransfer.setData(\"text/plain\",offset_data)\n  }\n\n  static function drag_over(event) {\n      const offset\n      try {\n          offset = event.dataTransfer.getData(\"text/plain\").split(',')\n      }\n      catch(e) {\n          offset = offset_data.split(',')\n      }\n      const dm = document.getElementById('dragme')\n      dm.style.left = (event.clientX + parseInt(offset[0],10)) + 'px'\n      dm.style.top = (event.clientY + parseInt(offset[1],10)) + 'px'\n      event.preventDefault()\n      return false\n  }\n\n  static function drop(event) {\n      const offset\n      try {\n          offset = event.dataTransfer.getData(\"text/plain\").split(',')\n      }\n      catch(e) {\n          offset = offset_data.split(',')\n      }\n      const dm = document.getElementById('dragme')\n      dm.style.left = (event.clientX + parseInt(offset[0],10)) + 'px'\n      dm.style.top = (event.clientY + parseInt(offset[1],10)) + 'px'\n      event.preventDefault()\n      return false\n  }\n  const dm = document.getElementById('dragme')\n  dm.addEventListener('dragstart',drag_start,false)\n  document.body.addEventListener('dragover',drag_over,false)\n  document.body.addEventListener('drop',drop,false)\n  */\n\n}\n\n$( () => App.init() )\n\nexport default App\n"]}